# ProChainRM - é¡¹ç›®å…¨å±€è®¤çŸ¥æ–‡æ¡£

**åˆ›å»ºæ—¶é—´**: 2026-01-02
**æœ€åæ›´æ–°**: 2026-01-05

---

## é¡¹ç›®å®šä½

ProChainRM (Professional Chaincode Resource Management) æ˜¯ä¸€ä¸ªåŸºäº Hyperledger Fabric çš„å°è¯´èµ„æºç®¡ç†ç³»ç»Ÿï¼Œå°†å°è¯´ã€ç”¨æˆ·ç­‰èµ„æºä¸Šé“¾ï¼Œå®ç°å»ä¸­å¿ƒåŒ–ç®¡ç†å’Œå¯è¿½æº¯æ€§ã€‚

---

## æ ¸å¿ƒæ¶æ„

### æŠ€æœ¯æ ˆ
- **åŒºå—é“¾å¹³å°**: Hyperledger Fabric
- **é“¾ç è¯­è¨€**: Go (Chaincode)
- **API æœåŠ¡**: Go + Gin Web Framework
- **æ•°æ®åº“**: MongoDB (é“¾ä¸‹ç¼“å­˜)
- **ç½‘å…³**: Fabric Gateway SDK
- **å®¹å™¨åŒ–**: Docker & Docker Compose

### ç³»ç»Ÿåˆ†å±‚
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         REST API Layer (Gin)            â”‚
â”‚  /api/v1/novels, /users, /recharge      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service Layer                   â”‚
â”‚  - ChaincodeService                     â”‚
â”‚  - EventService                         â”‚
â”‚  - ChaincodeMigrationService            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Fabric Gateway SDK                 â”‚
â”‚  (è¿æ¥ Fabric ç½‘ç»œ)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Hyperledger Fabric Network         â”‚
â”‚  - novel-resource-events (é“¾ç )        â”‚
â”‚  - Peer Nodes                           â”‚
â”‚  - Orderer                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†• (åŒæ­¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MongoDB (é“¾ä¸‹æ•°æ®)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®å½•ç»“æ„è¯´æ˜

```
ProChainRM/
â”œâ”€â”€ test-network/              # Fabric æµ‹è¯•ç½‘ç»œé…ç½®
â”‚   â”œâ”€â”€ network.sh            # ç½‘ç»œå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ organizations/        # ç»„ç»‡è¯ä¹¦å’Œè¿æ¥é…ç½®
â”œâ”€â”€ novel-resource-management/ # ä¸»åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ api/                  # API å±‚
â”‚   â”‚   â””â”€â”€ server.go         # Gin æœåŠ¡å™¨å’Œè·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ service/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ network/              # Fabric ç½‘ç»œè¿æ¥
â”‚   â”œâ”€â”€ database/             # MongoDB è¿æ¥
â”‚   â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶ (è®¤è¯ã€CORS)
â”‚   â”œâ”€â”€ main.go               # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ test_recharge.go      # å……å€¼æ¥å£æµ‹è¯•
â”œâ”€â”€ novel-resource-events/    # é“¾ç å®ç°
â”‚   â””â”€â”€ chaincode/            # æ™ºèƒ½åˆçº¦é€»è¾‘
â”œâ”€â”€ asset-transfer-basic/     # å®˜æ–¹ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ docs/                     # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ refresh-mongodb.go        # MongoDB å‰¯æœ¬é›†åˆ·æ–°å·¥å…· (Go)
â”œâ”€â”€ refresh.sh                # MongoDB å‰¯æœ¬é›†åˆ·æ–°è„šæœ¬ (ä¾¿æ·)
â”œâ”€â”€ README_MONGO_REFRESH.md   # MongoDB åˆ·æ–°å·¥å…·æ–‡æ¡£
â”œâ”€â”€ go.mod                    # Go æ¨¡å—ä¾èµ–
â”œâ”€â”€ go.sum                    # ä¾èµ–æ ¡éªŒå’Œ
â””â”€â”€ schema/                   # ä»»åŠ¡æ–‡æ¡£
    â”œâ”€â”€ archive/              # å·²å®Œæˆä»»åŠ¡å½’æ¡£
    â”‚   â”œâ”€â”€ task_recharge_260102.md
    â”‚   â””â”€â”€ task_mongo_refresh_260105.md
    â””â”€â”€ task_*.md            # è¿›è¡Œä¸­çš„ä»»åŠ¡
```

---

## æ ¸å¿ƒ API ç«¯ç‚¹

### å°è¯´ç®¡ç†
- `GET /api/v1/novels` - è·å–æ‰€æœ‰å°è¯´
- `GET /api/v1/novels/:id` - è·å–å•ä¸ªå°è¯´
- `POST /api/v1/novels` - åˆ›å»ºå°è¯´
- `PUT /api/v1/novels/:id` - æ›´æ–°å°è¯´
- `DELETE /api/v1/novels/:id` - åˆ é™¤å°è¯´

### ç”¨æˆ·ç®¡ç†
- `GET /api/v1/users` - è·å–æ‰€æœ‰ç”¨æˆ·
- `GET /api/v1/users/:id` - è·å–å•ä¸ªç”¨æˆ·
- `POST /api/v1/users` - åˆ›å»ºç”¨æˆ·
- `PUT /api/v1/users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/v1/users/:id` - åˆ é™¤ç”¨æˆ·

### Token ç»æµ (æ ¸å¿ƒåŠŸèƒ½)
- `POST /api/v1/users/recharge` - **ç”¨æˆ·å……å€¼æ¥å£**
- `POST /api/v1/users/:id/consume-token` - æ¶ˆè´¹ Token

### äº‹ä»¶ç›‘å¬
- `GET /api/v1/events/listen` - ç›‘å¬é“¾ç äº‹ä»¶

### å¥åº·æ£€æŸ¥
- `GET /health` - æœåŠ¡å¥åº·çŠ¶æ€

---

## éƒ¨ç½²æµç¨‹

### 1. å¯åŠ¨ Fabric ç½‘ç»œ
```bash
cd test-network
./network.sh up
./network.sh createChannel
```

### 2. éƒ¨ç½²é“¾ç 
```bash
./network.sh deployCC \
  -ccn novel-basic \
  -ccp ../novel-resource-events \
  -ccl go \
  -cci InitLedger \
  -ccep "OR('Org1MSP.member','Org2MSP.member')"
```

### 3. å¯åŠ¨ API æœåŠ¡
```bash
cd ../novel-resource-management
source ../test-network/scripts/set-env.sh  # è®¾ç½®ç¯å¢ƒå˜é‡
go run main.go
```

### 4. ä½¿ç”¨ Docker Compose (æ¨è)
```bash
docker-compose up -d
```

---

## å…³é”®ç‰¹æ€§

1. **æ•°æ®åŒæ­¥**: å¯åŠ¨æ—¶è‡ªåŠ¨ä» MongoDB åŒæ­¥æ•°æ®åˆ°é“¾ç 
2. **äº‹ä»¶ç›‘å¬**: å®æ—¶ç›‘å¬é“¾ç äº‹ä»¶å¹¶å¤„ç†
3. **ä¸€è‡´æ€§éªŒè¯**: è‡ªåŠ¨éªŒè¯é“¾ä¸Šé“¾ä¸‹æ•°æ®ä¸€è‡´æ€§
4. **Token ç»æµ**: æ”¯æŒç”¨æˆ·å……å€¼å’Œæ¶ˆè´¹ Token
5. **RSA åŠ å¯†**: æ•æ„Ÿæ•°æ®ä½¿ç”¨ RSA åŠ å¯†å­˜å‚¨

---

## é‡è¦é…ç½®

- **API ç«¯å£**: 8080
- **è¿æ¥é…ç½®**: `test-network/organizations/peerOrganizations/org1.example.com/connection-org1.json`
- **ç¯å¢ƒå˜é‡**: è§ `.env.example`

---

## é‡è¦å˜æ›´è®°å½•

### 2026-01-05
#### 1. Recharge æ¥å£ P0 å®‰å…¨ä¿®å¤
- âœ… å®Œæˆ recharge æ¥å£çš„ä¸¤ä¸ª P0 çº§åˆ«å®‰å…¨é—®é¢˜ä¿®å¤
- ğŸ“„ ä»»åŠ¡å½’æ¡£: `schema/archive/task_p0_fix_260105_144625.md`
- ğŸ”§ ä¸»è¦å®ç°:
  - **HMAC-SHA256 ç­¾åéªŒè¯**: `ComputeHMACSignature()` å’Œ `ValidateHMACSignature()`
  - **æ—¶é—´æˆ³éªŒè¯ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰**: `ValidateTimestamp()`ï¼Œ5åˆ†é’Ÿæœ‰æ•ˆæœŸ
  - **å……å€¼è®°å½•å¹‚ç­‰æ€§ä¿è¯**: `RechargeRecord` ç»“æ„ä½“ï¼Œè®¢å•å·å”¯ä¸€ç´¢å¼•
  - **æ•°æ®åº“ç´¢å¼•é…ç½®**: ä¸º `recharge_records` é›†åˆæ·»åŠ è®¢å•å·ã€ç”¨æˆ·IDã€æ—¶é—´ç´¢å¼•
- ğŸ’¡ å®‰å…¨ç‰¹æ€§: ç­¾åé˜²ç¯¡æ”¹ã€é˜²é‡æ”¾æ”»å‡»ã€å¹‚ç­‰æ€§ä¿è¯ã€ç¯å¢ƒå˜é‡å¯†é’¥é…ç½®

#### 2. å®‰å…¨å……å€¼æ¥å£æµ‹è¯•è„šæœ¬å‡çº§
- âœ… å®Œæˆ recharge æ¥å£å®‰å…¨æ”¹é€ åçš„å®Œæ•´æµ‹è¯•è„šæœ¬
- ğŸ“„ ä»»åŠ¡å½’æ¡£: `schema/archive/task_test_recharge_260105_155035.md`
- ğŸ”§ ä¸»è¦æ”¹é€ : `test_recharge.go`
  - æ–°å¢ `timestamp` å’Œ `signature` å­—æ®µæ”¯æŒ
  - å®ç° HMAC-SHA256 ç­¾åè®¡ç®—å‡½æ•°
  - æ·»åŠ 5ä¸ªæ–°æµ‹è¯•åœºæ™¯ï¼šå¹‚ç­‰æ€§ã€ç­¾åé”™è¯¯ã€æ—¶é—´æˆ³è¿‡æœŸ/æœªæ¥éªŒè¯
- ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½: è‡ªåŠ¨ç­¾åè®¡ç®—ã€å¤šåœºæ™¯å®‰å…¨éªŒè¯ã€å‘åå…¼å®¹è®¾è®¡

#### 3. MongoDB å‰¯æœ¬é›†åˆ·æ–°å·¥å…·å¼€å‘
- âœ… å®Œæˆ MongoDB å‰¯æœ¬é›†åˆ·æ–°å·¥å…·å¼€å‘
- ğŸ“„ ä»»åŠ¡å½’æ¡£: `schema/archive/task_mongo_refresh_260105.md`
- ğŸ”§ æ–°å¢æ–‡ä»¶:
  - `refresh-mongodb.go` - Go æºä»£ç 
  - `refresh-mongo.sh` - ä¾¿æ·è„šæœ¬
  - `README_MONGO_REFRESH.md` - å®Œæ•´æ–‡æ¡£
  - `go.mod`, `go.sum` - Go æ¨¡å—ä¾èµ–
- ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½: è‡ªåŠ¨æ£€æµ‹å±€åŸŸç½‘ IPã€æ™ºèƒ½æ›´æ–°å‰¯æœ¬é›†é…ç½®ã€æ— éœ€é‡å¯ Docker å®¹å™¨

### 2026-01-06
#### 1. æ‰¹é‡ä»»åŠ¡å½’æ¡£æ•´ç†
- âœ… å½’æ¡£å¤šä¸ªå·²å®Œæˆæˆ–è¿›è¡Œä¸­çš„ä»»åŠ¡æ–‡æ¡£
- ğŸ“„ ä»»åŠ¡å½’æ¡£åˆ—è¡¨:
  - `task_recharge_upgrade_260104_161555.md` - Recharge æ¥å£å‡çº§æ–¹æ¡ˆè®¾è®¡
  - `task_recharge_research_260105_162659.md` - å……å€¼æ¥å£å®‰å…¨éªŒè¯ï¼ˆHMAC/æ—¶é—´æˆ³/å¹‚ç­‰ï¼‰è°ƒç ”
  - `task_schema_gitignore_260105_163713.md` - Schemaç›®å½•Gitè¿½è¸ªé…ç½®è°ƒæ•´
  - `task_check_docker_logs_260105_173302.md` - Dockeræ—¥å¿—äº¤æ˜“è®°å½•æ£€æŸ¥
  - `task_fix_recharge_260105_180640.md` - å……å€¼Tokenå¤±è´¥é—®é¢˜ä¿®å¤
  - `task_log_analysis_260105_204847.md` - æ—¥å¿—åˆ†æé—®é¢˜å®šä½
  - `task_secret_key_260105_213129.md` - RECHARGE_SECRET_KEYç¯å¢ƒå˜é‡å®‰å…¨åˆ†æ
  - `task_mongo_research_260106_123440.md` - MongoDBåº“ã€å‰¯æœ¬é›†åŸç†è¯¦ç»†è°ƒç ”
- ğŸ” å½’æ¡£çŠ¶æ€: å·²å®Œæˆæˆ–è¿›è¡Œä¸­çš„ä»»åŠ¡ç»Ÿä¸€å½’æ¡£ç®¡ç†

### 2026-01-02
- âœ… å®Œæˆ recharge æ¥å£å…¨é¢è°ƒç ”
- ğŸ“„ è°ƒç ”æŠ¥å‘Šå½’æ¡£: `schema/archive/task_recharge_260102.md`
- ğŸ” æ ¸å¿ƒå‘ç°: å›ºå®šå……å€¼ 150 Tokenã€é“¾ä¸Šé“¾ä¸‹åŒå†™æœºåˆ¶ã€äº‹ä»¶é©±åŠ¨æ¶æ„

---

## å·²çŸ¥é—®é¢˜

1. **DNS è§£æ**: éœ€è¦åœ¨ `/etc/hosts` æ·»åŠ  `127.0.0.1 orderer.example.com`
2. **ç«¯å£å ç”¨**: 9443 ç«¯å£è¢«å ç”¨ä¼šå¯¼è‡´ createChannel å¡ä½
3. **è¶…æ—¶é…ç½®**: æŸäº›æ“ä½œéœ€è¦è¾ƒé•¿è¶…æ—¶æ—¶é—´ (å¦‚ CommitTimeout 2åˆ†é’Ÿ)

---

**ç»´æŠ¤è¯´æ˜**:
- æ­¤æ–‡æ¡£æ˜¯é¡¹ç›®çš„å…¨å±€è®¤çŸ¥åŸºç¡€
- æ¶æ„å˜æ›´æ—¶å¿…é¡»åŒæ­¥æ›´æ–°
- æ–°å¢åŠŸèƒ½æˆ–æ¨¡å—æ—¶æ›´æ–°ç›®å½•ç»“æ„è¯´æ˜
